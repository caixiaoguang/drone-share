(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b78bbb8"],{"027e":function(e,t,a){},1:function(e,t){},"14e4":function(e,t,a){"use strict";var i=a("972b"),s=a.n(i);s.a},"371d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container publish-container"},[a("el-row",{staticClass:"shadow-container"},[a("div",{staticClass:"page-nav"},[a("span",[a("i",{staticClass:"el-icon-document-add"},[e._v("发布信息")])])]),e._v(" "),a("el-col",{attrs:{span:14}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-form",{ref:"form",attrs:{size:"mini","label-width":"120px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"我要发布："}},[a("el-select",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-option",{attrs:{label:"供应信息",value:"supplyInfo",disabled:""==e.$store.getters.userInfo.companyName}}),e._v(" "),a("el-option",{attrs:{label:"需求信息",value:"demandInfo"}})],1),e._v(" "),""==e.$store.getters.userInfo.companyName?a("span",{staticClass:"input-tips",staticStyle:{color:"red"}},[e._v("去个人中心绑定公司后才可以发布供应信息")]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"发布类型"}},[a("el-radio-group",{on:{change:e.initForm},model:{value:e.submitType,callback:function(t){e.submitType=t},expression:"submitType"}},[a("el-radio",{attrs:{label:"aerialData"}},[e._v("航测数据")]),e._v(" "),a("el-radio",{attrs:{label:"airspace"}},[e._v("空域")]),e._v(" "),a("el-radio",{attrs:{label:"project"}},[e._v("项目")]),e._v(" "),"demandInfo"==e.form.type?a("el-radio",{attrs:{label:"drones"}},[e._v("无人机")]):e._e(),e._v(" "),"demandInfo"==e.form.type?a("el-radio",{attrs:{label:"drivers"}},[e._v("飞手")]):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"标题",prop:"name"}},[a("el-input",{attrs:{placeholder:"简单描述您的信息"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),"project"==e.submitType?a("el-form-item",{attrs:{label:"项目类型",prop:"businessFields"}},[a("el-select",{model:{value:e.form.businessFields,callback:function(t){e.$set(e.form,"businessFields",t)},expression:"form.businessFields"}},e._l(e.companyOptions[1].value,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),e._v(" "),"drone"!=e.submitType&&"driver"!=e.submitType?a("district-select",{model:{value:e.administrativDivision,callback:function(t){e.administrativDivision=t},expression:"administrativDivision"}}):e._e(),e._v(" "),e.editorTableColumns&&e.editorTableColumns.length>0?[a("el-table-editor",{ref:"tableEdit",staticClass:"table-editer",attrs:{columns:e.editorTableColumns,tableAttrs:e.tableAttrs,rules:e.droneAndDriverRules[e.submitType]},model:{value:e.form[e.submitType],callback:function(t){e.$set(e.form,e.submitType,t)},expression:"form[submitType]"}})]:e._e(),e._v(" "),"supplyInfo"==e.form.type&&"aerialData"==e.submitType||"supplyInfo"==e.form.type&&"airspace"==e.submitType?a("el-form-item",{attrs:{label:"上传数据范围"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:function(t){e.uploadVisible=!0}}},[e._v("点击上传")]),e._v(" "),""!=e.form.region?a("el-tag",{attrs:{closable:""},on:{close:e.handleUploadTagClose}},[e._v(e._s(e.uploadFileName))]):a("span",{staticClass:"input-tips"},[e._v("暂无上传数据")])],1):e._e(),e._v(" "),"project"==e.submitType?a("el-form-item",{attrs:{label:"项目面积"}},[a("el-input",{staticClass:"mini-input",model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}}),e._v(" "),a("span",{staticClass:"input-tips"},[e._v("平方千米")])],1):e._e(),e._v(" "),"aerialData"==e.submitType?[a("el-form-item",{attrs:{label:"数据类型",prop:"aerialDataType"}},[a("el-select",{attrs:{placeholder:"选择数据类型"},model:{value:e.form.aerialDataType,callback:function(t){e.$set(e.form,"aerialDataType",t)},expression:"form.aerialDataType"}},[a("el-option",{attrs:{label:"正射影像",value:"正射影像"}}),e._v(" "),a("el-option",{attrs:{label:"倾斜摄影",value:"倾斜摄影"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"航测面积"}},[a("el-input",{staticClass:"mini-input",attrs:{placeholder:"输入面积"},model:{value:e.form.area,callback:function(t){e.$set(e.form,"area",t)},expression:"form.area"}}),e._v(" "),a("span",{staticClass:"input-tips"},[e._v("平方千米")])],1),e._v(" "),a("el-form-item",{attrs:{label:"拍摄日期"}},[a("el-date-picker",{staticClass:"mini-input",attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分辨率"}},[a("el-input",{staticClass:"mini-input",attrs:{placeholder:"输入分辨率"},model:{value:e.form.resolution,callback:function(t){e.$set(e.form,"resolution",t)},expression:"form.resolution "}})],1),e._v(" "),a("el-form-item",{attrs:{label:"精度"}},[a("el-input",{staticClass:"mini-input",attrs:{placeholder:"输入精度"},model:{value:e.form.precision,callback:function(t){e.$set(e.form,"precision",t)},expression:"form.precision"}})],1)]:e._e(),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.form.notes,callback:function(t){e.$set(e.form,"notes",t)},expression:"form.notes"}})],1),e._v(" "),a("div",[a("el-button",{staticClass:"submit-btn",attrs:{type:"primary",size:"small",disabled:e.isLoading,icon:e.isLoading?"el-icon-loading":""},on:{click:function(t){return e.submitInfo("form")}}},[e._v("提交信息")])],1)],2)],1)]),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple-light"},[a("div",{staticClass:"title",staticStyle:{padding:"20px"}},[a("span",[e._v("推荐列表:")])])])])],1),e._v(" "),a("el-dialog",{staticClass:"upload-file",attrs:{title:"上传文件并预览",visible:e.uploadVisible,top:"0","append-to-body":"","destroy-on-close":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.uploadVisible=t},close:e.uploadClose}},[a("div",{staticClass:"upload-container"},[a("el-upload",{staticClass:"upload-component",attrs:{action:"console","auto-upload":!1,"on-change":e.file2url,accept:".zip",limit:1}},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-folder-opened"}},[e._v("点击选择文件")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("将shapefile中的所有文件压缩为ZIP，文件中不要包含目录。每个ZIP文件只能包含一个shapefile 文件集")])],1),e._v(" "),a("el-divider"),e._v(" "),a("div",{staticClass:"map-container"},[a("main-map",{on:{mapReady:e.mapReady}},[0!=Object.keys(e.geojson).length?a("l-geo-json",{attrs:{geojson:e.geojson},on:{ready:e.geojsonReady}}):e._e()],1)],1),e._v(" "),a("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleUploadCancle}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitUpload}},[e._v("确 定")])],1)],1)])],1)},s=[],o=(a("ac6a"),a("456d"),a("7f7f"),a("db72")),l=(a("bc3a"),a("0c1e")),n=a("044a"),r=a("3931"),c=a("274e"),u=a("c24f"),p=a("3620"),m=a("310e"),d=a.n(m),f={components:{MainMap:r["a"],LGeoJson:n["a"],DistrictSelect:c["a"],ElTableEditor:l["a"]},data:function(){return{companyOptions:p["a"],tableAttrs:{size:"mini"},isLoading:!1,form:"",submitType:"aerialData",administrativDivision:"",uploadVisible:!1,geojson:[],uploadFileName:"",droneAndDriverRules:p["e"],rules:{name:[{required:!0,message:"请输入标题",trigger:"blur"},{min:3,max:10,message:"长度在 3 到 50 个字符",trigger:"blur"}],businessFields:{required:!0,message:"请选择类型",trigger:"change"},aerialDataType:{required:!0,message:"请选择数据类型",trigger:"change"}}}},computed:{editorTableColumns:function(){return"demandInfo"!=this.form.type?[]:"drones"==this.submitType?p["c"].filter((function(e){return"droneMaker"!=e.prop&&"buyTime"!=e.prop&&"isSale"!=e.prop&&"maxLoad"!=e.prop})):"drivers"==this.submitType?p["b"]:void 0}},created:function(){this.initForm()},methods:{submitInfo:function(e){var t=this,a=!0;this.$refs[e].validate((function(e){if(e){if("drones"==t.submitType||"drivers"==t.submitType){if(a=!1,0==t.form[t.submitType].length)return void t.$message.warning("请至少添加一条记录！");t.$refs["tableEdit"].validate().then((function(){t.releaseInfo()})).catch((function(e){console.log(e)}))}a&&t.releaseInfo()}}))},initForm:function(){this.form={aerialDataType:"",area:"",businessFields:"",date:"",drones:[],drivers:[],name:"",notes:"",resolution:"",precision:"",region:"",type:"demandInfo",userId:this.$store.getters.userInfo.userId}},releaseInfo:function(){var e=this;this.isLoading=!0,this.form.region&&(this.form.region=JSON.stringify(this.form.region)),Object(u["c"])(Object(o["a"])({},this.form,{},this.administrativDivision,{releaseType:this.submitType})).then((function(t){e.isLoading=!1,t.code})).catch((function(t){console.log(t),e.isLoading=!1}))},file2url:function(e,t){var a=this;this.uploadFileName=e.name;var i=new FileReader;i.readAsArrayBuffer(e.raw),i.onload=function(){d()(i.result).then((function(e){Array.isArray(e)?a.$message({showClose:!0,type:"error",message:"zip中只能包含一个ship文件，请重新选择！"}):a.geojson=e})).catch((function(e){console.log(e),a.$message.error("解析shp失败，请检查数据")}))}},uploadClose:function(){this.map=null,this.geojson={}},mapReady:function(e){this.map=e},geojsonReady:function(e){this.map.fitBounds(e.getBounds())},submitUpload:function(){0==Object.keys(this.geojson).length?this.$message.warning("没有正确解析shp文件"):(this.form.region=this.geojson,this.$message.success("成功解析shp文件")),this.uploadVisible=!1},handleUploadCancle:function(){this.$message("上传取消"),this.uploadVisible=!1},handleUploadTagClose:function(){this.form.region="",this.uploadFileName=""}}},b=f,v=(a("c5b4"),a("38e1"),a("2877")),y=Object(v["a"])(b,i,s,!1,null,"5e3c9069",null);t["default"]=y.exports},"38e1":function(e,t,a){"use strict";var i=a("40e9"),s=a.n(i);s.a},3931:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-container"},[a("l-map",{attrs:{zoom:e.zoom,"max-zoom":32,center:e.center,options:e.options},on:{ready:e.mapReady}},[e._t("default"),e._v(" "),a("l-control-layers",{attrs:{collapsed:!0,"sort-layers":!0},on:{ready:e.layerControlReady}}),e._v(" "),a("l-feature-group",{attrs:{"layer-type":"base",name:"天地图"}},e._l(e.tianditu,(function(e){return a("l-tile-layer",{key:e.name,attrs:{url:e.url,visible:e.visible}})})),1),e._v(" "),a("l-tile-layer",{attrs:{name:"影像图","layer-type":"base",visible:!1,url:e.satellite.url}})],2)],1)},s=[],o=a("2699"),l=a("9ee8"),n=a("a40a"),r=a("c5ca"),c=a("044a"),u=a("2b0e"),p={props:{isMain:{type:Boolean,default:!1}},components:{LMap:o["a"],LControlLayers:l["a"],LTileLayer:n["a"],LFeatureGroup:r["a"],LGeoJson:c["a"]},data:function(){return{zoom:9,center:[26.51,106.62],options:{attributionControl:!1,preferCanvas:!0},tianditu:[{name:"tianditu",visible:!0,url:"https://t0.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=1902c209c7a7480dfb962751b839b91e"},{name:"tianditu_label",visible:!0,url:"https://t0.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=1902c209c7a7480dfb962751b839b91e"}],satellite:{name:"satellite",url:"https://t2.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=1902c209c7a7480dfb962751b839b91e"}}},methods:{mapReady:function(e){this.isMain&&(u["default"].prototype.$map=e),this.$emit("mapReady",e)},layerControlReady:function(e){this.isMain&&(u["default"].prototype.$layerControl=e)}}},m=p,d=(a("14e4"),a("2877")),f=Object(d["a"])(m,i,s,!1,null,"601753f7",null);t["a"]=f.exports},"40e9":function(e,t,a){},"972b":function(e,t,a){},c5b4:function(e,t,a){"use strict";var i=a("027e"),s=a.n(i);s.a}}]);